{#
    Contact Landing Template
#}

{% extends "layouts/base/_base_parallax" %}

{% set title = entry.title %}
{% set type = 'landing' %}

{# Get building #}
{% set building = entry.building.one() %}

{# Get hours from entry #}
{% set hoursOfOperation = entry.hoursOfOperation %}

{# Set up our array of weekdays #}
{% set days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'] %}
{% set daysShort = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'] %}
{% set daysInitial = ['S', 'M', 'T', 'W', 'T', 'F', 'S'] %}

{# Setup a new array operationHours to hold all you hashes
   and prev variables to compare things to in the loop
 #}
{% set operationHours, prevDays, prevDaysShort, prevOpen, prevClose = [],[],[],"","" %}

{# Check to see if a preference has been set to change the default week start day from Sunday to Monday #}
{% set startDay = currentUser.getPreference('weekStartDay') ?? craft.app.config.general.defaultWeekStartDay %}
{% if startDay != 0 %}
  {% set days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
  {% set daysShort = ['Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'] %}
  {% set daysInitial = ['M', 'T', 'W', 'T', 'F', 'S', 'S'] %}
  {% set hoursOfOperation = entry.hoursOfOperation|slice(1,entry.hoursOfOperation|length)|merge(entry.hoursOfOperation|slice(0,1)) %}
{% endif %}

{# Loop thru the Hours of Operation field and build the operationHours array #}
{% for item in hoursOfOperation %}

  {# in the first loop, setup the prevOpen and prevClose variables  #}
  {% if loop.first %}
    {% set prevOpen, prevClose = item.open, item.close %}
  {% endif %}

  {# If the prev hours match the current item's hours,
     add that day's name to the array of prev days, ["Monday","Tuesday"] etc.
   #}
  {% if prevOpen == item.open and prevClose == item.close %}
    {% set prevDays = prevDays|merge([days[loop.index0]]) %}
    {% set prevDaysShort = prevDaysShort|merge([daysShort[loop.index0]]) %}

  {# If it doesn't match, add prev variables as a hash to the operationHours array,
     Then set all prev variables with current item
   #}
  {% else %}

    {% set operationHours = operationHours|merge([{
      "days" : prevDays,
      "daysShort" : prevDaysShort,
      "open" : prevOpen,
      "close" : prevClose
    }]) %}

    {% set prevDays = [days[loop.index0]] %}
    {% set prevDaysShort = [daysShort[loop.index0]] %}
    {% set prevOpen = item.open %}
    {% set prevClose = item.close %}

  {% endif %}

  {# If last loop, add prev variables as a hash to the operationHours array
     because there won't be another loop to compare it to.
   #}
  {% if loop.last %}
    {% set operationHours = operationHours|merge([{
      "days" : prevDays,
      "daysShort" : prevDaysShort,
      "open" : prevOpen,
      "close" : prevClose
    }]) %}
  {% endif %}

{% endfor %}








{# HEADER IMAGE #}
{% block parallaxBack %}
  {% if entry.primaryImage | length %}{% include "modules/content/_header-block" %}{% endif %}
{% endblock %}


{# MAIN COLUMN CONTENT #}
{% block content %}

<section id="contact--address">

  <div id="contact--address-data" itemscope itemtype="http://schema.org/GovernmentBuilding">

    {% if logo.logoIcon | length %}
    <figure id="contact--logo-icon">
      {% set logoUrl = 'https:' ~ logo.logoIcon.one().getUrl() %}
      {{ craft.inlin.er(logoUrl, true) | raw }}
    </figure>
    {% endif %}

    <h4>Address</h4>
    <span itemprop="name">{{ building.title | typogrify }}</span>
    <div class="address" itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
      <span itemprop="streetAddress">{{ building.buildingAddress.addressLine2 }}</span><br>
      <span itemprop="addressLocality">{{ building.buildingAddress.locality }}</span>,
      <span itemprop="addressRegion">{{ building.buildingAddress.administrativeArea }}</span>
      <span itemprop="postalCode">{{ building.buildingAddress.postalCode }}</span>
    </div>

    <h4>Office Hours</h4>
    {% for item in operationHours %}
    <div class="hours">
      {% if item.open|length and item.close|length %}
        <meta itemprop="openingHours"
          content="{{ item.daysShort|join(',') }} {{ item.open|date('H:i') }}-{{ item.close|date('H:i') }}">
          {{ item.daysShort|first }}{% if item.daysShort|length > 1 %}-{{ item.daysShort|last }}{% endif %}<br>
          {{ item.open|date('g:ia') }}-{{ item.close|date('g:ia') }}
      {% else %}
        <meta class="hours__hours" itemprop="openingHours"
          content="{{ item.daysShort|join(',') }} Closed">
          Closed {{ item.daysShort|first }}{% if item.daysShort|length > 1 %}-{{ item.daysShort|last }}{% endif %}
      {% endif %}
    </div>
    {% endfor %}

    {% if general.tollFreePhoneNumber %}
    <h4>Toll-Free</h4>
    <div class="phone">
      {# {% set tfPhoneLength = general.tollFreePhoneNumber|length %}
      {% set tfNewLength = tfPhoneLength - 10 %}
      {% set tfUnformattedNumber = general.tollFreePhoneNumber|slice(tfNewLength, tfPhoneLength) %}
      {% set tfAreaCode = tfUnformattedNumber|slice(0, 3) %}
      {% set tfPhoneSliceA = tfUnformattedNumber|slice(3, 3) %}
      {% set tfPhoneSliceB = tfUnformattedNumber|slice(6, 4) %}
      <span itemprop="telephone">{{ '(' ~ tfAreaCode ~ ') ' ~ tfPhoneSliceA ~ '-' ~ tfPhoneSliceB }}</span> #}
      <span itemprop="telephone">{{ general.tollFreePhoneNumber }}</span>
    </div>
    {% endif %}

    {% if entry.phone %}
    <h4>Phone</h4>
    <div class="phone">
      {# {% set phoneLength = entry.phone.phoneNumber|length %}
      {% set newLength = phoneLength - 10 %}
      {% set unformattedNumber = entry.phone.phoneNumber|slice(newLength, phoneLength) %}
      {% set areaCode = unformattedNumber|slice(0, 3) %}
      {% set phoneSliceA = unformattedNumber|slice(3, 3) %}
      {% set phoneSliceB = unformattedNumber|slice(6, 4) %}
      <span itemprop="telephone">{{ '(' ~ areaCode ~ ') ' ~ phoneSliceA ~ '-' ~ phoneSliceB }}</span> #}
      <span itemprop="telephone">{{ entry.phone }}</span>
    </div>
    {% endif %}

    <a href="{{ craft.entries.section('directoryLanding').one().url }}" title="Staff Directory">Staff Directory</a>

  </div>

  <div id="contact--address-map">
    <div id="map"></div>
    <a href="{{ building.buildingAddress.mapUrl }}" target="_blank" title="Get Directions to {{ building.title }}">Directions</a>
  </div>

</section>

<section id="contact--info-request">
  <h1>Public Information Request</h1>
  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
</section>

<section id="contact--form">
  <div id="contact--form--content">

    <h1>Submit a Question or Comment</h1>
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis turpis urna, tempor ut ornare id, condimentum et felis.</p>

    <form action="#">
      <fieldset>
        <div class="form-group">
          <div class="form-input">
            <label for="first_name">First Name</label>
            <input type="text" id="first_name" placeholder="First Name">
          </div>
          <div class="form-input">
            <label for="last_name">Last Name</label>
            <input type="text" id="last_name" placeholder="Last Name">
          </div>
        </div>
        <div class="form-group">
          <div class="form-input">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Email">
          </div>
          <div class="form-input">
            <label for="phone">Phone</label>
            <input id="phone" type="tel" name="phone" placeholder="Phone">
          </div>
        </div>
        <div>
          <label for="dropdown">Dropdown</label>
          <select id="dropdown" data-choices>
            <option>
              Select Option
            </option>
            <option>
              Option 02
            </option>
            <option>
              Option 03
            </option>
            <option>
              Option 04
            </option>
          </select>
        </div>
        <div>
          <label for="subject">Subject</label>
          <input type="text" id="subject" placeholder="Subject">
        </div>
        <div>
          <label for="message">Message</label>
          <textarea id="message" cols="30" rows="5" placeholder="Begin message..."></textarea>
        </div>
        <div class="center">
          <input type="submit" id="submit" value="Submit">
        </div>
      </fieldset>
    </form>

  </div>
</section>




{% set mapsJs %}
{% minify js %}
google.maps.event.addDomListener(window, 'load', initializeContactMap({{building.buildingAddress.latitude}},{{building.buildingAddress.longitude}}));
{% endminify %}
{% endset %}

{% do view.registerJsFile('//maps.googleapis.com/maps/api/js?key=' ~ craft.app.config.general.googleApiKey ~ '&v=3.exp') %}

{% js mapsJs %}

{% endblock %}
